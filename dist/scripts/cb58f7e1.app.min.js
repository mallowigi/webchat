angular.module("webChat.common",[]),angular.module("webChat.common").constant("events",{POST_MESSAGE:"webChat:postMessage",RECEIVE_MESSAGE:"webChat.receiveMessage"}),angular.module("webChat.common").factory("chance",["$window",function(a){"use strict";var b=a.chance;if(!b)throw Error("chance is not defined");return b.channel=function(){return b.pick(["#random","#general","#ux","#ui","#frontend","#backend"])},b}]),angular.module("webChat.common").directive("dragNDrop",function(){return{restrict:"A",compile:function(a,b,c){return a.on("dragover",function(a){a.preventDefault()}),a.on("dragstart",function(a){var b={x:a.offsetX,y:a.offsetY};a.dataTransfer.setData("iFrameID",a.target.id),a.dataTransfer.setData("mouseCoords",JSON.stringify(b))}),a.on("drop",function(a){var b,c=a.dataTransfer.getData("iFrameID"),d=JSON.parse(a.dataTransfer.getData("mouseCoords")),e=a.x-d.x,f=a.y-d.y;if(window.parent!==window){b=window.parent.document.getElementById(c);var g=b.getElementsByTagName("iframe")[0],h=g.getBoundingClientRect();e+=h.left,f+=h.top}else b=document.getElementById(c);b.style.top=f+"px",b.style.left=e+"px"}),function(a,b,c){}}}}),angular.module("webChat.chatWindow",["webChat.common"]),angular.module("webChat.chatWindow").service("ChatWindow",["chance",function(a){"use strict";function b(){this.id=a.guid(),this.name=a.first(),this.initPos={left:a.natural({min:0,max:800})+"px",top:a.natural({min:0,max:400})+"px"}}return b}]),angular.module("webChat.chatWindow").directive("chatWindowBox",function(){"use strict";return{restrict:"E",templateUrl:"chatWindowBox",controller:["$scope","$window","events",function(a,b,c){this.author=b.name,this.message="",this.messages=[],this.postMessage=function(){var b={author:this.author,contents:this.message};this.message="",a.$emit(c.POST_MESSAGE,b)},a.$on(c.RECEIVE_MESSAGE,function(b,c){this.messages.push(c),a.$digest()}.bind(this))}],controllerAs:"chat"}}),angular.module("webChat.core",["ngAnimate","webChat.chatWindow"]),angular.module("webChat.core").directive("chatIframe",["$interpolate",function(a){"use strict";return{restrict:"E",replace:!0,scope:{name:"@"},compile:function(b,c,d){var e='<iframe frameborder="0" src="chat.html" name="{{ name }}" seamless width="359" height="450" scrolling="no"></iframe>';return function(b,c,d){var f=a(e)(b);angular.element(c).append(f)}}}}]),angular.module("webChat.core").controller("MainCtrl",["$window","ChatWindow",function(a,b){"use strict";this.chatWindows=[],this.addNewWindow=function(){this.chatWindows.push(new b)},this.closeWindow=function(a){this.chatWindows.splice(a,1)}}]),angular.module("webChat",["webChat.core"]),angular.module("webChat").run(["$rootScope","$window","events",function(a,b,c){"use strict";a.$on(c.POST_MESSAGE,function(a,c){var d=Array.prototype.slice.call(b.parent.frames);d.forEach(function(a){a.postMessage(c,"*")})}),angular.element(b).on("message",function(b){if(b=b.originalEvent||b,b&&b.data){a.sender=b.source;var d=b.data;a.$broadcast(c.RECEIVE_MESSAGE,d)}})}]);